<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>用vite的方式开发electron应用 | 黄禄松的博客</title><meta name="keywords" content="vite,electron"><meta name="author" content="黄禄松,1113794717@qq.com"><meta name="copyright" content="黄禄松"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="用vite的方式开发electron应用vite的构建方式让前端人员的编程体验好了太多，最近在学习electron应用的开发，就在想能不能使用vite的方式开发electron应用。看了很多方案，大部分都是基于webpack的脚手架。 那么有没有一种方式能够将vite结合electron，来开发electron应用呢？答案当然是有的，作为electron与vite整合开源方案中最火的项目：vite">
<meta property="og:type" content="article">
<meta property="og:title" content="用vite的方式开发electron应用">
<meta property="og:url" content="https://huanglusong.github.io/2023/12/17/%E7%94%A8vite%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91electron%E5%BA%94%E7%94%A8/index.html">
<meta property="og:site_name" content="黄禄松的博客">
<meta property="og:description" content="用vite的方式开发electron应用vite的构建方式让前端人员的编程体验好了太多，最近在学习electron应用的开发，就在想能不能使用vite的方式开发electron应用。看了很多方案，大部分都是基于webpack的脚手架。 那么有没有一种方式能够将vite结合electron，来开发electron应用呢？答案当然是有的，作为electron与vite整合开源方案中最火的项目：vite">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://huanglusong.github.io/resources/img/banner1.jpg">
<meta property="article:published_time" content="2023-12-16T17:26:46.000Z">
<meta property="article:modified_time" content="2023-12-17T03:01:26.936Z">
<meta property="article:author" content="黄禄松">
<meta property="article:tag" content="vite,electron">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://huanglusong.github.io/resources/img/banner1.jpg"><link rel="shortcut icon" href="/resources/img/avatar.jpg"><link rel="canonical" href="https://huanglusong.github.io/2023/12/17/%E7%94%A8vite%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91electron%E5%BA%94%E7%94%A8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-LrDMx8BXP8"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?9d99b89863bee99b06caa7d4e321bae3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-17 11:01:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2236480_mzzd02u00is.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/resources/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page" href="/pictures/"><i class="fa-fw fas fa-camera-retro"></i><span> 图片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/pictures/"><i class="fa-fw fas fa-camera-retro"></i><span> 图片</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cn.vitejs.dev/logo-with-shadow.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">黄禄松的博客</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page" href="/pictures/"><i class="fa-fw fas fa-camera-retro"></i><span> 图片</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/pictures/"><i class="fa-fw fas fa-camera-retro"></i><span> 图片</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">用vite的方式开发electron应用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-16T17:26:46.000Z" title="发表于 2023-12-17 01:26:46">2023-12-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-17T03:01:26.936Z" title="更新于 2023-12-17 11:01:26">2023-12-17</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>20分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="用vite的方式开发electron应用"><a href="#用vite的方式开发electron应用" class="headerlink" title="用vite的方式开发electron应用"></a>用vite的方式开发electron应用</h1><p><code>vite</code>的构建方式让前端人员的编程体验好了太多，最近在学习<code>electron</code>应用的开发，就在想能不能使用<code>vite</code>的方式开发<code>electron</code>应用。看了很多方案，大部分都是基于<code>webpack</code>的脚手架。</p>
<p>那么有没有一种方式能够将<code>vite</code>结合<code>electron</code>，来开发<code>electron</code>应用呢？答案当然是有的，作为<code>electron</code>与<code>vite</code>整合开源方案中最火的项目：<a target="_blank" rel="noopener" href="https://github.com/electron-vite/vite-plugin-electron">vite-plugin-electron</a>  。本文将基于这个项目的实现思路，详细记录如何编写<code>vite</code>插件并在最终手写一个<code>vite</code>插件，实现用<code>vite</code>的方式开发<code>electron</code>应用这么一个小目标。</p>
<p>阅读本文前你需要对<code>vite</code>有一个基本的认识，否则你将对一些内容感到一头雾水。如果你对<code>vite</code>的插件开发有兴趣的话，请一定耐心阅读完本文，干货满满。</p>
<p>在本文中我将提到以下几点：</p>
<ul>
<li><code>vite</code>插件的基础知识与简单应用</li>
<li><code>electron</code>应用开发的入门</li>
<li><code>vite</code>整合<code>electron</code>应用开发的思路</li>
<li>编写<code>vite</code>插件实现<code>vite</code>与<code>electron</code>应用的整合</li>
</ul>
<h2 id="vite插件的基础知识与简单应用"><a href="#vite插件的基础知识与简单应用" class="headerlink" title="vite插件的基础知识与简单应用"></a>vite插件的基础知识与简单应用</h2><p><code>vite</code>插件的用途简单来说就是帮助我们在<code>vite</code>构建的不同生命周期中执行我们需要的业务逻辑，这有时候对我们很重要。<code>vite</code>针对这些生命周期暴露出了很多对应的生命周期函数钩子，我们只需要实现这些钩子函数即可。</p>
<h3 id="vite的生命周期"><a href="#vite的生命周期" class="headerlink" title="vite的生命周期"></a>vite的生命周期</h3><p><code>vite</code>的生命周期分为两种：<code>rollup</code>的生命周期和<code>vite</code>特有的生命周期。</p>
<h4 id="通用钩子"><a href="#通用钩子" class="headerlink" title="通用钩子"></a>通用钩子</h4><p>我们知道<code>vite</code>项目打包时底层依赖的是<code>rollup</code>，而<code>rollup</code>打包过程是有自己的一套生命周期的，<code>vite</code>为了与其保持一致，故保留了相应的生命周期钩子，这些称作通用钩子。</p>
<p>服务启动时被调用：</p>
<ul>
<li><code>options</code>：这是构建阶段的第一个钩子，用于替换或操作传递给 <code>rollup.rollup</code> 的选项对象</li>
<li><code>buildStart</code>：可获取<code>rollup.rollup</code> 的选项对象</li>
</ul>
<p>传入每个模块请求时被调用：</p>
<ul>
<li><code>resolveId</code></li>
<li><code>load</code></li>
<li><code>transform</code></li>
</ul>
<p>服务器关闭时被调用：</p>
<ul>
<li><code>buildEnd</code>：在 <code>Rollup</code> 完成产物但尚未调用 <code>generate</code> 或 <code>write</code> 之前调用</li>
<li><code>closeBundle</code>：<code>bundle.close()</code>后最后一个触发的钩子，一般可用于清理可能正在运行的任何外部服务</li>
</ul>
<h4 id="vite特用的钩子"><a href="#vite特用的钩子" class="headerlink" title="vite特用的钩子"></a>vite特用的钩子</h4><h5 id="config"><a href="#config" class="headerlink" title="config"></a>config</h5><p>在解析 <code>vite</code>配置前调用，它可以返回一个将被深度合并到现有配置中的部分配置对象，或者直接改变配置（如果默认的合并不能达到预期的结果）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回部分配置（推荐）</span></span><br><span class="line"><span class="keyword">const</span> partialConfigPlugin = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">  name: <span class="string">&#x27;return-partial&#x27;</span>,</span><br><span class="line">  config: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      alias: &#123;</span><br><span class="line">        foo: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接改变配置（应仅在合并不起作用时使用）</span></span><br><span class="line"><span class="keyword">const</span> mutateConfigPlugin = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">  name: <span class="string">&#x27;mutate-config&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="title">config</span>(<span class="params">config, &#123; command &#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (command === <span class="string">&#x27;build&#x27;</span>) &#123;</span><br><span class="line">      config.root = <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="configResolved"><a href="#configResolved" class="headerlink" title="configResolved"></a>configResolved</h5><p>在解析 Vite 配置后调用。使用这个钩子读取和存储最终解析的配置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> examplePlugin = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> config</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">&#x27;read-config&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">configResolved</span>(<span class="params">resolvedConfig</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// 存储最终解析的配置</span></span><br><span class="line">      config = resolvedConfig</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在其他钩子中使用存储的配置</span></span><br><span class="line">    <span class="function"><span class="title">transform</span>(<span class="params">code, id</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (config.command === <span class="string">&#x27;serve&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// dev: 由开发服务器调用的插件</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// build: 由 Rollup 调用的插件</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="configureServer"><a href="#configureServer" class="headerlink" title="configureServer"></a>configureServer</h5><p>是用于配置开发服务器的钩子，最常见的用例是在内部 <a target="_blank" rel="noopener" href="https://github.com/senchalabs/connect">connect</a> 应用程序中添加自定义中间件。</p>
<p><code>connect</code>应用程序是一个中间件层，可往其中添加很多中间件</p>
<p>中间件可简单理解为一个<strong>函数或拦截器</strong>，请求在进入正式的业务逻辑前，会先被<strong>中间件链（拦截器链）</strong>处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myPlugin = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">  name: <span class="string">&#x27;configure-server&#x27;</span>,</span><br><span class="line">  <span class="function"><span class="title">configureServer</span>(<span class="params">server</span>)</span> &#123;</span><br><span class="line">    server.middlewares.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 自定义请求处理...</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="其余不常用的钩子"><a href="#其余不常用的钩子" class="headerlink" title="其余不常用的钩子"></a>其余不常用的钩子</h5><ul>
<li><code>configurePreviewServer</code></li>
<li><code>transformIndexHtml</code></li>
<li><code>handleHotUpdate</code></li>
</ul>
<h3 id="vite的简单应用"><a href="#vite的简单应用" class="headerlink" title="vite的简单应用"></a>vite的简单应用</h3><p>首先通过<code>vite</code>的官方模板创建一个<code>vite</code>项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest</span><br></pre></td></tr></table></figure>

<p>编写一个简单的插件，插件的作用只是在各个生命周期钩子被调用时打印内容和参数，代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名为：vite-plugin-featureTest.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Plugin &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> FeatureTestOption &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (option: FeatureTestOption): <span class="function"><span class="params">Plugin</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name: <span class="string">&#x27;featureTest&#x27;</span>,</span><br><span class="line">        options: <span class="function">(<span class="params">curOpt</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;通用钩子options被调用！参数为：&#x27;</span>,curOpt)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;==========================================================&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        buildStart:<span class="function">(<span class="params">curOpt</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;通用钩子buildStart被调用！参数为：&#x27;</span>,curOpt)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;==========================================================&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        buildEnd:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;通用钩子buildEnd被调用！&#x27;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;==========================================================&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        closeBundle:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;通用钩子closeBundle被调用！&#x27;</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;==========================================================&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        config:<span class="function">(<span class="params">cfg,env</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;vite特有的钩子config被调用！参数config为：&#x27;</span>,cfg,<span class="string">&#x27;参数env为：&#x27;</span>,env)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;==========================================================&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        configResolved:<span class="function">(<span class="params">cfg</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;vite特有的钩子configResolve被调用！参数config为：&#x27;</span>,cfg)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;==========================================================&#x27;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        configureServer:<span class="function">(<span class="params">server</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;vite特有的钩子configureServer被调用！参数server：&#x27;</span>,server)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;==========================================================&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们使用<code>typesecipt</code>进行开发来获取更好的代码提示。开发一个插件其实很简单，就是要定义一个类型为<code>Plugin</code>的对象，但是为了更好的扩展性，插件约定俗成的写法是通过函数返回<code>Plugin</code>类型的对象，同时函数接收一个插件参数对象。</p>
<p>生命周期的钩子在<code>Plugin</code>类型对象中都有一一对应的属性，属性值为一个函数，我们的工作就是编写这些函数。</p>
<p>接下来，我们要在<code>vite</code>配置中引入我们编写的插件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名：vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vite&#x27;</span></span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&#x27;@vitejs/plugin-vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> myVitePlugin <span class="keyword">from</span> <span class="string">&#x27;./plugins/vite-plugin-featureTest&#x27;</span></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    vue(),</span><br><span class="line">    myVitePlugin(&#123;&#125;)</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在<code>plugins</code>数组中调用插件暴露的函数即可。</p>
<p>最后观察结果：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\huanghe\others\vscode-projects\learnElectronAndVite\vite-project&gt; npm run dev</span><br><span class="line"></span><br><span class="line">&gt; vite-project@<span class="number">0.0</span><span class="number">.0</span> dev</span><br><span class="line">&gt; vite</span><br><span class="line"></span><br><span class="line">vite特有的钩子config被调用！参数config为： &#123;       </span><br><span class="line">  plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:vue&#x27;</span>,</span><br><span class="line">      api: [<span class="built_in">Object</span>],</span><br><span class="line">      handleHotUpdate: [<span class="built_in">Function</span>: handleHotUpdate],</span><br><span class="line">      config: [<span class="built_in">Function</span>: config],</span><br><span class="line">      configResolved: [<span class="built_in">Function</span>: configResolved],  </span><br><span class="line">      configureServer: [<span class="built_in">Function</span>: configureServer],</span><br><span class="line">      buildStart: [<span class="built_in">Function</span>: buildStart],</span><br><span class="line">      resolveId: [AsyncFunction: resolveId],       </span><br><span class="line">      load: [<span class="built_in">Function</span>: load],</span><br><span class="line">      transform: [<span class="built_in">Function</span>: transform]</span><br><span class="line">    &#125;,</span><br><span class="line">    ....省略...</span><br><span class="line">&#125; </span><br><span class="line">参数env为： &#123;</span><br><span class="line">  mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  command: <span class="string">&#x27;serve&#x27;</span>,</span><br><span class="line">  isSsrBuild: <span class="literal">false</span>,</span><br><span class="line">  isPreview: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">==========================================================</span><br><span class="line">vite特有的钩子configResolve被调用！参数config为： &#123;</span><br><span class="line">  </span><br><span class="line">  ....省略....</span><br><span class="line">&#125;</span><br><span class="line">==========================================================</span><br><span class="line">通用钩子options被调用！参数为： &#123;&#125;</span><br><span class="line">==========================================================</span><br><span class="line">vite特有的钩子configureServer被调用！参数server： &#123;</span><br><span class="line">  </span><br><span class="line">  ...省略...</span><br><span class="line">&#125;</span><br><span class="line">==========================================================</span><br><span class="line">通用钩子buildStart被调用！参数为： &#123;&#125;</span><br><span class="line">==========================================================</span><br><span class="line"></span><br><span class="line">  VITE v5<span class="number">.0</span><span class="number">.10</span>  ready <span class="keyword">in</span> <span class="number">659</span> ms</span><br><span class="line"></span><br><span class="line">  ➜  Local:   http:<span class="comment">//localhost:5173/</span></span><br><span class="line">  ➜  Network: use --host to expose</span><br><span class="line">  ➜  press h + enter to show help</span><br></pre></td></tr></table></figure>

<p>从最后的结果中我们可以发现，我们定义的函数分别在<code>vite</code>构建过程的不同阶段被调用。</p>
<p><strong>有个特别的点我专门记录下：</strong></p>
<p><code>configResolved</code>阶段能获取最终的<code>config</code>，从中我们发现了很多不是我们配置的<code>plugin</code>，这些是<code>vite</code>帮我们注入的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:optimized-deps&#x27;</span>,</span><br><span class="line">      resolveId: [<span class="built_in">Function</span>: resolveId],</span><br><span class="line">      load: [AsyncFunction: load]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:watch-package-data&#x27;</span>,</span><br><span class="line">      buildStart: [<span class="built_in">Function</span>: buildStart],</span><br><span class="line">      buildEnd: [<span class="built_in">Function</span>: buildEnd],</span><br><span class="line">      watchChange: [<span class="built_in">Function</span>: watchChange],</span><br><span class="line">      handleHotUpdate: [<span class="built_in">Function</span>: handleHotUpdate]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;vite:pre-alias&#x27;</span>, <span class="attr">resolveId</span>: [AsyncFunction: resolveId] &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;alias&#x27;</span>,</span><br><span class="line">      buildStart: [AsyncFunction: buildStart],</span><br><span class="line">      resolveId: [<span class="built_in">Function</span>: resolveId]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:modulepreload-polyfill&#x27;</span>,</span><br><span class="line">      resolveId: [<span class="built_in">Function</span>: resolveId],</span><br><span class="line">      load: [<span class="built_in">Function</span>: load]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:resolve&#x27;</span>,</span><br><span class="line">      resolveId: [AsyncFunction: resolveId],</span><br><span class="line">      load: [<span class="built_in">Function</span>: load]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:html-inline-proxy&#x27;</span>,</span><br><span class="line">      resolveId: [<span class="built_in">Function</span>: resolveId],</span><br><span class="line">      load: [<span class="built_in">Function</span>: load]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:css&#x27;</span>,</span><br><span class="line">      configureServer: [<span class="built_in">Function</span>: configureServer],</span><br><span class="line">      buildStart: [<span class="built_in">Function</span>: buildStart],</span><br><span class="line">      transform: [AsyncFunction: transform]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:esbuild&#x27;</span>,</span><br><span class="line">      configureServer: [<span class="built_in">Function</span>: configureServer],</span><br><span class="line">      buildEnd: [<span class="built_in">Function</span>: buildEnd],</span><br><span class="line">      transform: [AsyncFunction: transform]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;vite:json&#x27;</span>, <span class="attr">transform</span>: [<span class="built_in">Function</span>: transform] &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:wasm-helper&#x27;</span>,</span><br><span class="line">      resolveId: [<span class="built_in">Function</span>: resolveId],</span><br><span class="line">      load: [AsyncFunction: load]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:worker&#x27;</span>,</span><br><span class="line">      configureServer: [<span class="built_in">Function</span>: configureServer],</span><br><span class="line">      buildStart: [<span class="built_in">Function</span>: buildStart],</span><br><span class="line">      load: [<span class="built_in">Function</span>: load],</span><br><span class="line">      shouldTransformCachedModule: [<span class="built_in">Function</span>: shouldTransformCachedModule],</span><br><span class="line">      transform: [AsyncFunction: transform],</span><br><span class="line">      renderChunk: [<span class="built_in">Function</span>: renderChunk],</span><br><span class="line">      generateBundle: [<span class="built_in">Function</span>: generateBundle]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:asset&#x27;</span>,</span><br><span class="line">      buildStart: [<span class="built_in">Function</span>: buildStart],</span><br><span class="line">      configureServer: [<span class="built_in">Function</span>: configureServer],</span><br><span class="line">      resolveId: [<span class="built_in">Function</span>: resolveId],</span><br><span class="line">      load: [AsyncFunction: load],</span><br><span class="line">      renderChunk: [<span class="built_in">Function</span>: renderChunk],</span><br><span class="line">      generateBundle: [<span class="built_in">Function</span>: generateBundle]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;vite:vue&#x27;</span>,</span><br><span class="line">      api: [<span class="built_in">Object</span>],</span><br><span class="line">      handleHotUpdate: [<span class="built_in">Function</span>: handleHotUpdate],</span><br><span class="line">      config: [<span class="built_in">Function</span>: config],</span><br><span class="line">      configResolved: [<span class="built_in">Function</span>: configResolved],</span><br><span class="line">      configureServer: [<span class="built_in">Function</span>: configureServer],</span><br><span class="line">      buildStart: [<span class="built_in">Function</span>: buildStart],</span><br><span class="line">      resolveId: [AsyncFunction: resolveId],</span><br><span class="line">      load: [<span class="built_in">Function</span>: load],</span><br><span class="line">      transform: [<span class="built_in">Function</span>: transform]</span><br><span class="line">    &#125;,</span><br><span class="line">    ...省略...</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure>

<h2 id="electron应用开发的入门"><a href="#electron应用开发的入门" class="headerlink" title="electron应用开发的入门"></a>electron应用开发的入门</h2><p><code>Electron</code>是一个使用 <code>JavaScript</code>、<code>HTML</code> 和 <code>CSS</code> 构建桌面应用程序的框架。</p>
<p><code>Electron</code>将<code>Chromium</code>和<code>Node.js</code>嵌入到应用中，因此可以使用他们的特性，并天然的拥有跨平台的特性。</p>
<h3 id="electron技术的核心概念"><a href="#electron技术的核心概念" class="headerlink" title="electron技术的核心概念"></a>electron技术的核心概念</h3><p><code>electron</code>使用的是多进程架构，分为<strong>主进程</strong>和<strong>渲染进程</strong>。</p>
<h4 id="主进程"><a href="#主进程" class="headerlink" title="主进程"></a>主进程</h4><p>主进程在 <code>Node.js</code> 环境中运行，这意味着它具有 <code>require</code> 模块和使用所有 <strong>Node.js API</strong> 的能力。</p>
<p><code>Electron</code>封装了很多<strong>原生API</strong>，这使得在主进程中有操控原生桌面功能的能力，例如菜单、对话框以及托盘图标。</p>
<h4 id="渲染器进程"><a href="#渲染器进程" class="headerlink" title="渲染器进程"></a>渲染器进程</h4><p>每个 <code>Electron</code> 应用都会为每个打开的 <code>BrowserWindow</code> ( 与每个网页嵌入 ) 生成一个单独的<strong>渲染器进程</strong>。 洽如其名，渲染器负责 <em>渲染</em> 网页内容。 所以实际上，运行于渲染器进程中的代码是须遵照网页标准的。因此渲染器进程中运行的代码，与web应用的开发方式是完全一致的。</p>
<p>渲染器进程可以完整的使用<code>nodejs</code>的api，但是出于安全考虑，这项特性现在已经被默认禁用。</p>
<h3 id="electron应用快速入门"><a href="#electron应用快速入门" class="headerlink" title="electron应用快速入门"></a>electron应用快速入门</h3><p>我们来编写一个<code>electron</code>应用的hello-world案例，了解如何开发<code>electron</code>应用。</p>
<p><code>electron</code>是基于<code>nodejs</code>的，老生常谈的<code>nodejs</code>项目的初始化流程就此跳过了。</p>
<hr>
<p>安装<code>electron</code>框架的依赖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev electron</span><br></pre></td></tr></table></figure>

<hr>
<p><code>package.json</code>中新增一条<code>script</code>命令，将<code>main</code>属性中指定为<code>main.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;electron-helloworld&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dev&quot;</span>:<span class="string">&quot;electron .&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;keywords&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span>,</span><br><span class="line">  <span class="string">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;electron&quot;</span>: <span class="string">&quot;^28.0.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们新增了一条<code>dev</code>命令，内容为<code>electron .</code></p>
<p><code>electron</code>应用启动的时候默认会取<code>main</code>属性中指定的js文件作为主进程的逻辑</p>
<hr>
<p>编写<code>main.js</code>文件，其将在主进程中执行，具有完全的<code>nodejs</code> api的能力</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Modules to control application life and create native browser window</span></span><br><span class="line"><span class="keyword">const</span> &#123; app, BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createWindow = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Create the browser window.</span></span><br><span class="line">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">    width: <span class="number">800</span>,</span><br><span class="line">    height: <span class="number">600</span>,</span><br><span class="line">    webPreferences: &#123;</span><br><span class="line">    <span class="comment">//   preload: path.join(__dirname, &#x27;preload.js&#x27;)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载 index.html</span></span><br><span class="line">  mainWindow.loadFile(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这段程序将会在 Electron 结束初始化</span></span><br><span class="line"><span class="comment">// 和创建浏览器窗口的时候调用</span></span><br><span class="line"><span class="comment">// 部分 API 在 ready 事件触发后才能使用。</span></span><br><span class="line">app.whenReady().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  createWindow()</span><br><span class="line"></span><br><span class="line">  app.on(<span class="string">&#x27;activate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 在 macOS 系统内, 如果没有已开启的应用窗口</span></span><br><span class="line">    <span class="comment">// 点击托盘图标时通常会重新创建一个新窗口</span></span><br><span class="line">    <span class="keyword">if</span> (BrowserWindow.getAllWindows().length === <span class="number">0</span>) createWindow()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 除了 macOS 外，当所有窗口都被关闭的时候退出程序。 因此, 通常</span></span><br><span class="line"><span class="comment">// 对应用程序和它们的菜单栏来说应该时刻保持激活状态, </span></span><br><span class="line"><span class="comment">// 直到用户使用 Cmd + Q 明确退出</span></span><br><span class="line">app.on(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.platform !== <span class="string">&#x27;darwin&#x27;</span>) app.quit()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们来看一下<code>main.js</code>文件的内容：</p>
<p>引入<code>app</code>和<code>BrowserWindow</code>模块，</p>
<ul>
<li><code>app</code>模块负责控制应用程序的事件生命周期</li>
<li><code>BrowserWindow</code>模块，它创建和管理应用程序 窗口</li>
</ul>
<p>添加一个<code>createWindow()</code>方法来将<code>index.html</code>加载进一个新的<code>BrowserWindow</code>实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createWindow = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Create the browser window.</span></span><br><span class="line">  <span class="keyword">const</span> mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">    width: <span class="number">800</span>,</span><br><span class="line">    height: <span class="number">600</span>,</span><br><span class="line">    webPreferences: &#123;</span><br><span class="line">    <span class="comment">//   preload: path.join(__dirname, &#x27;preload.js&#x27;)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载 index.html</span></span><br><span class="line">  mainWindow.loadFile(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>Electron</code> 中，只有在 <code>app</code> 模块的 <code>ready</code> 事件被激发后才能创建浏览器窗口。 您可以通过使用 <code>app.whenReady</code>() API来监听此事件。 在<code>whenReady()</code>成功后调用<code>createWindow()</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.whenReady().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  createWindow()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>当所有的窗口都关闭，<code>app</code>则退出，<code>electron</code>相关进程都结束。</p>
<hr>
<p>编写<code>index.html</code>，作为浏览器窗口渲染的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>home<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello electron<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>最后，我们启动项目看一看效果</p>
<p><img src="https://huanghedidi-img-repository.oss-cn-shenzhen.aliyuncs.com/20231216202125.png" alt="electron启动界面"></p>
<h2 id="vite整合electron开发的思路"><a href="#vite整合electron开发的思路" class="headerlink" title="vite整合electron开发的思路"></a>vite整合electron开发的思路</h2><p>在分析整合思路前我们先梳理下<code>vite</code>和<code>electron</code>各自的开发模式：</p>
<p><code>vite</code>在开发阶段使用<code>dev-server</code>预览项目，其会提供一个<code>url</code>地址。部署阶段将项目打包成静态资源，包括<code>html</code>，<code>js</code>和<code>css</code>等等。</p>
<p><code>electron</code>主进程中运行的代码是在<code>Nodejs</code>环境中，渲染进程运行的代码可以认为在<strong>浏览器环境</strong>中，浏览器窗口中加载的渲染内容可以选择是<code>html</code>静态资源也可以是一个<code>url</code>地址，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种 url方式</span></span><br><span class="line">win.loadURL(VITE_DEV_SERVER_URL)</span><br><span class="line"><span class="comment">// 文件方式</span></span><br><span class="line">win.loadFile(path.join(process.env.DIST, <span class="string">&#x27;index.html&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>那么在分析<code>vite</code>整合<code>electron</code>进行开发的方案时，我们就可以设想以下的思路：</p>
<ul>
<li>在开发阶段，<code>electron</code>渲染进程通过访问<code>vite</code>的<code>dev-server</code>暴露的<code>url</code>来加载内容</li>
<li>在部署阶段，<code>electron</code>通过<code>vite</code>的构建产物加载内容</li>
</ul>
<p>为了验证这种思路，我们分别基于<code>vite</code>和<code>electron</code>创建两个项目。</p>
<p>开发阶段：我们启动<code>vite</code>项目，<code>vite</code>的<code>dev-server</code>提供的url是<a target="_blank" rel="noopener" href="http://localhost:5173/%EF%BC%8C%E9%80%9A%E8%BF%87%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AE%E5%91%88%E7%8E%B0%E7%9A%84%E5%86%85%E5%AE%B9%E6%98%AF%EF%BC%9A**hello">http://localhost:5173/，通过浏览器访问呈现的内容是：**hello</a> vite!!!**</p>
<p><img src="https://huanghedidi-img-repository.oss-cn-shenzhen.aliyuncs.com/20231216204319.png"></p>
<p>接着，我们进入<code>electron</code>项目，并将这个<code>url</code>写入<code>electron</code>的主进程代码中，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win.loadURL(<span class="string">&quot;http://localhost:5173/&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>随后我们启动<code>electron</code>应用，效果如下：</p>
<p><img src="https://huanghedidi-img-repository.oss-cn-shenzhen.aliyuncs.com/20231216204610.png"></p>
<p>直接成功了！<code>electron</code>中呈现的也是：<strong>hello vite!!!</strong></p>
<p>部署阶段，过程也是类似，但是因为是两个项目过程较繁琐，我们跳过。</p>
<p>通过上述的实验，可以证明方案是可行的。但通过两个项目的方式开发<code>electron</code>应用终究是不优雅的，因此我们要探究一种能将这个思路完美整合到<code>vite</code>项目中的方式。</p>
<p>所幸<code>vite</code>的插件功能为我们提供了整合的可能性，接下来我们将探寻如何通过<code>vite</code>的插件，实现完美的基于<code>vite</code>的<code>electron</code>开发方案。</p>
<h2 id="通过vite插件实现vite与electron的整合"><a href="#通过vite插件实现vite与electron的整合" class="headerlink" title="通过vite插件实现vite与electron的整合"></a>通过vite插件实现vite与electron的整合</h2><p>我们通过开发一个<code>vite</code>插件的方案来实现<code>vite</code>方式开发<code>electron</code>应用，我们将分为两种场景分别应对，一个是<strong>开发阶段</strong>，一个是编译阶段。</p>
<h3 id="开发阶段"><a href="#开发阶段" class="headerlink" title="开发阶段"></a>开发阶段</h3><p>首先是开发阶段，核心的思想就是让<code>vite</code>先通过<code>dev-server</code>的方式跑起来，并获取其<code>url</code>信息，再通过子进程的方式将<code>electron</code>应用启动，然后<code>electron</code>应用的渲染进程加载<code>vite</code>的<code>dev-server</code>的内容。</p>
<p>落地到<code>vite</code>插件的实现上，我们可以通过<code>configSever</code>钩子，获取到<code>vite</code>的<code>dev-server</code>的配置信息，并从中获取启动的<code>url</code>地址，然后保存到环境变量<code>process.env</code>中。我们通过监听<code>dev-server</code>的<code>listening</code>事件，保证在<code>vite</code>完全启动后，再使用<code>spawn</code>执行<code>electron .</code> 命令，启动<code>electron</code>应用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ChildProcess &#125; <span class="keyword">from</span> <span class="string">&quot;child_process&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AddressInfo &#125; <span class="keyword">from</span> <span class="string">&quot;net&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Plugin &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">interface</span> MyElectronOption &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> electronApp: ChildProcess</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (option: MyElectronOption): <span class="function"><span class="params">Plugin</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;electron的vite-plugin开始执行...........&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name: <span class="string">&#x27;myElectronPlugin&#x27;</span>,</span><br><span class="line">        configureServer: <span class="function">(<span class="params">server</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 监听server的listening事件</span></span><br><span class="line">            <span class="keyword">let</span> httpServer = server.httpServer!</span><br><span class="line">            httpServer.once(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> addressInfo = httpServer.address() <span class="keyword">as</span> AddressInfo</span><br><span class="line">                <span class="keyword">let</span> url = <span class="string">`http://<span class="subst">$&#123;addressInfo.address&#125;</span>:<span class="subst">$&#123;addressInfo.port&#125;</span>`</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`vite启动服务的url信息是：<span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">                <span class="built_in">Object</span>.assign(process.env, &#123; <span class="attr">VITE_DEV_SERVER_URL</span>: url &#125;)</span><br><span class="line">                startElectron()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动electron应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> startElectron = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; spawn &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;node:child_process&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> electron = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> electronPath = electron.default + <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`开始启动electron应用！启动命令为：<span class="subst">$&#123;electronPath&#125;</span>`</span>)</span><br><span class="line">    electronApp = spawn(electronPath, [<span class="string">&#x27;.&#x27;</span>], &#123; <span class="attr">stdio</span>: <span class="string">&#x27;inherit&#x27;</span> &#125;)</span><br><span class="line">    electronApp.once(<span class="string">&#x27;exit&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        process.exit()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在<code>App.vue</code>中写了如下要呈现的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello vite+electron!!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>来看看启动的效果</p>
<p><img src="https://huanghedidi-img-repository.oss-cn-shenzhen.aliyuncs.com/20231216232915.png"></p>
<p>看到结果，惊喜万分！！我们已经初步实现了通过<code>vite</code>的方式开发<code>electron</code>应用！！！并且当我们改变前端内容时，也是支持热加载的。</p>
<p>但是，如果我们改变了<code>electron</code>主进程的内容则不支持热加载，并且如果我们希望通过<code>ts</code>的方式编写主进程代码也不支持的，那么我们接下来针对这些痛点进行优化。</p>
<h4 id="优化插件"><a href="#优化插件" class="headerlink" title="优化插件"></a>优化插件</h4><p>我们通过更改<code>vite</code>的配置并手动调用<code>vite</code>的<code>build</code>方法即可将指定的文件进行预构建。</p>
<p>优化后的代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ChildProcess &#125; <span class="keyword">from</span> <span class="string">&quot;child_process&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AddressInfo &#125; <span class="keyword">from</span> <span class="string">&quot;net&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Plugin, InlineConfig, mergeConfig, build <span class="keyword">as</span> viteBuild &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; builtinModules &#125; <span class="keyword">from</span> <span class="string">&#x27;node:module&#x27;</span></span><br><span class="line"><span class="keyword">interface</span> MyElectronOption &#123;</span><br><span class="line">    vite: InlineConfig</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> defaultViteConfig: InlineConfig = &#123;</span><br><span class="line">    configFile: <span class="literal">false</span>,</span><br><span class="line">    publicDir: <span class="literal">false</span>,</span><br><span class="line">    build: &#123;</span><br><span class="line">        lib: &#123;</span><br><span class="line">            entry: <span class="string">&#x27;electron/main.ts&#x27;</span>,</span><br><span class="line">            formats: [<span class="string">&#x27;cjs&#x27;</span>],</span><br><span class="line">            fileName: <span class="function">() =&gt;</span> <span class="string">&#x27;[name].js&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        outDir: <span class="string">&#x27;dist-electron&#x27;</span>,</span><br><span class="line">        emptyOutDir: <span class="literal">false</span>,</span><br><span class="line">        watch: &#123;&#125;,</span><br><span class="line">        minify: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: []</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> electronApp: ChildProcess</span><br><span class="line"><span class="comment">// 标识刷新主进程main.js的修改</span></span><br><span class="line"><span class="keyword">let</span> refreshFlag: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line"><span class="comment">// 标识第一次启动electron</span></span><br><span class="line"><span class="keyword">let</span> firstFlag:<span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (option: MyElectronOption): <span class="function"><span class="params">Plugin</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;electron的vite-plugin开始执行...........&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name: <span class="string">&#x27;myElectronPlugin&#x27;</span>,</span><br><span class="line">        configureServer: <span class="function">(<span class="params">server</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 监听server的listening事件</span></span><br><span class="line">            <span class="keyword">let</span> httpServer = server.httpServer!</span><br><span class="line">            httpServer.once(<span class="string">&#x27;listening&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> addressInfo = httpServer.address() <span class="keyword">as</span> AddressInfo</span><br><span class="line">                <span class="keyword">let</span> url = <span class="string">`http://<span class="subst">$&#123;addressInfo.address&#125;</span>:<span class="subst">$&#123;addressInfo.port&#125;</span>`</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`vite启动服务的url信息是：<span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">                <span class="built_in">Object</span>.assign(process.env, &#123; <span class="attr">VITE_DEV_SERVER_URL</span>: url &#125;)</span><br><span class="line">                defaultViteConfig.mode = server.config.mode</span><br><span class="line">                defaultViteConfig.plugins.push(&#123;</span><br><span class="line">                    name: <span class="string">&#x27;startElectron&#x27;</span>,</span><br><span class="line">                    closeBundle: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">&#x27;主进程代码重新构建完毕，开始启动electron应用......&#x27;</span>)</span><br><span class="line">                        <span class="keyword">if</span>(firstFlag)&#123;</span><br><span class="line">                            firstFlag = <span class="literal">false</span></span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            refreshFlag = <span class="literal">true</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        startElectron()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">let</span> viteConfig: InlineConfig = withExternalBuiltins(mergeConfig(defaultViteConfig, option.vite))</span><br><span class="line">                viteBuild(viteConfig)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 启动electron应用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> startElectron = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (electronApp) &#123;</span><br><span class="line">        electronApp.kill()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; spawn &#125; = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;node:child_process&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> electron = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line">    <span class="keyword">let</span> electronPath = electron.default + <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`开始启动electron应用！启动命令为：<span class="subst">$&#123;electronPath&#125;</span>`</span>)</span><br><span class="line">    electronApp = spawn(electronPath, [<span class="string">&#x27;.&#x27;</span>], &#123; <span class="attr">stdio</span>: <span class="string">&#x27;inherit&#x27;</span> &#125;)</span><br><span class="line">    electronApp.once(<span class="string">&#x27;exit&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!refreshFlag) &#123;</span><br><span class="line">            process.exit()</span><br><span class="line">        &#125;</span><br><span class="line">        refreshFlag = <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> withExternalBuiltins = (config: InlineConfig): <span class="function"><span class="params">InlineConfig</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> builtins = builtinModules.filter(<span class="function"><span class="params">e</span> =&gt;</span> !e.startsWith(<span class="string">&#x27;_&#x27;</span>)); builtins.push(<span class="string">&#x27;electron&#x27;</span>, ...builtins.map(<span class="function"><span class="params">m</span> =&gt;</span> <span class="string">`node:<span class="subst">$&#123;m&#125;</span>`</span>))</span><br><span class="line"></span><br><span class="line">    config.build ??= &#123;&#125;</span><br><span class="line">    config.build.rollupOptions ??= &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> external = config.build.rollupOptions.external</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="built_in">Array</span>.isArray(external) ||</span><br><span class="line">        <span class="keyword">typeof</span> external === <span class="string">&#x27;string&#x27;</span> ||</span><br><span class="line">        external <span class="keyword">instanceof</span> <span class="built_in">RegExp</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        external = builtins.concat(external <span class="keyword">as</span> <span class="built_in">string</span>[])</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> external === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> original = external</span><br><span class="line">        external = <span class="function"><span class="keyword">function</span> (<span class="params">source, importer, isResolved</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (builtins.includes(source)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> original(source, importer, isResolved)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        external = builtins</span><br><span class="line">    &#125;</span><br><span class="line">    config.build.rollupOptions.external = external</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在<code>electron/main.ts</code>中编写<code>electron</code>主进程的逻辑，并通过<code>vite</code>构建到<code>dist-electron/main.js</code>下。因为<code>electron</code>识别的是<code>js</code>文件，我们还要将<code>package.json</code>中的<code>main</code>属性调整至：<code>dist-electron/main.js</code></p>
<p>经过这个优化我们实现了以下特性：</p>
<ul>
<li>只要我们调整了<code>electron/main.ts</code>的内容，<code>electron</code>会自动重启并且不退出<code>vite</code>服务</li>
<li>只要我们关闭<code>electron</code>应用，<code>vite</code>服务也会自动退出</li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>至此，我们通过<code>vite</code>插件的方式，已经基本实现了通过<code>vite</code>的方式开发<code>electron</code>应用这个目标，也就是我们完全可以按照原先开发<strong>web应用</strong>的方式来开发<strong>electron应用</strong>了。</p>
<p>关于构建场景下vite插件的实现，有空了再来详细记录填坑。</p>
<p><strong>vite插件的实现方案参考的是<a target="_blank" rel="noopener" href="https://github.com/electron-vite/vite-plugin-electron">vite-plugin-electron</a> ，有兴趣的小伙伴可到他的仓库地址详细阅读源码。</strong></p>
<p>关于本文中的所有代码，均已上传：<a target="_blank" rel="noopener" href="https://github.com/huanglusong/learnElectronAndVite">github仓库：learnElectronAndVite</a></p>
<p>欢迎访问的我的个人博客：<a href="https://huanglusong.github.io/">https://huanglusong.github.io/</a></p>
<p>欢迎加入我创建的qq技术交流群：<strong>624017389</strong></p>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/api-plugin">vite官方中文文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/">Electron官方中文文档</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/electron-vite/vite-plugin-electron">vite-plugin-electron</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1113794717@qq.com">黄禄松</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://huanglusong.github.io/2023/12/17/%E7%94%A8vite%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91electron%E5%BA%94%E7%94%A8/">https://huanglusong.github.io/2023/12/17/%E7%94%A8vite%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91electron%E5%BA%94%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://huanglusong.github.io" target="_blank">黄禄松的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vite-electron/">vite,electron</a></div><div class="post_share"><div class="social-share" data-image="/resources/img/banner1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/06/18/%E5%9F%BA%E4%BA%8Eipv6%E5%AE%9E%E7%8E%B0%E5%87%A0%E4%B9%8E%E9%9B%B6%E6%88%90%E6%9C%AC%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%96%B9%E6%A1%88%EF%BC%8C%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B8%A9%E5%9D%91%E5%8E%86%E7%A8%8B%E4%B8%8E%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/"><img class="next-cover" src="/resources/img/banner1.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">基于ipv6实现几乎零成本的内网穿透方案，小白的踩坑历程与经验分享</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/resources/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">黄禄松</div><div class="author-info__description">我发现我的脑子支撑不了我的想法</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/huanglusong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/huanglusong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/qq_40748336" target="_blank" title="CSDN"><i class="iconfont icon-csdn1"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">人生最大的幸运是做自己喜欢的事</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8vite%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91electron%E5%BA%94%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">用vite的方式开发electron应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vite%E6%8F%92%E4%BB%B6%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%8E%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8"><span class="toc-number">1.1.</span> <span class="toc-text">vite插件的基础知识与简单应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">vite的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E9%92%A9%E5%AD%90"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">通用钩子</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vite%E7%89%B9%E7%94%A8%E7%9A%84%E9%92%A9%E5%AD%90"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">vite特用的钩子</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#config"><span class="toc-number">1.1.1.2.1.</span> <span class="toc-text">config</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#configResolved"><span class="toc-number">1.1.1.2.2.</span> <span class="toc-text">configResolved</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#configureServer"><span class="toc-number">1.1.1.2.3.</span> <span class="toc-text">configureServer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BD%99%E4%B8%8D%E5%B8%B8%E7%94%A8%E7%9A%84%E9%92%A9%E5%AD%90"><span class="toc-number">1.1.1.2.4.</span> <span class="toc-text">其余不常用的钩子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vite%E7%9A%84%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">vite的简单应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#electron%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E7%9A%84%E5%85%A5%E9%97%A8"><span class="toc-number">1.2.</span> <span class="toc-text">electron应用开发的入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#electron%E6%8A%80%E6%9C%AF%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">electron技术的核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">主进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E5%99%A8%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">渲染器进程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#electron%E5%BA%94%E7%94%A8%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.2.2.</span> <span class="toc-text">electron应用快速入门</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vite%E6%95%B4%E5%90%88electron%E5%BC%80%E5%8F%91%E7%9A%84%E6%80%9D%E8%B7%AF"><span class="toc-number">1.3.</span> <span class="toc-text">vite整合electron开发的思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87vite%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0vite%E4%B8%8Eelectron%E7%9A%84%E6%95%B4%E5%90%88"><span class="toc-number">1.4.</span> <span class="toc-text">通过vite插件实现vite与electron的整合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5"><span class="toc-number">1.4.1.</span> <span class="toc-text">开发阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E6%8F%92%E4%BB%B6"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">优化插件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.4.2.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">1.5.</span> <span class="toc-text">引用</span></a></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/12/17/%E7%94%A8vite%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91electron%E5%BA%94%E7%94%A8/" title="用vite的方式开发electron应用"><img src="/resources/img/banner1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="用vite的方式开发electron应用"/></a><div class="content"><a class="title" href="/2023/12/17/%E7%94%A8vite%E7%9A%84%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91electron%E5%BA%94%E7%94%A8/" title="用vite的方式开发electron应用">用vite的方式开发electron应用</a><time datetime="2023-12-16T17:26:46.000Z" title="发表于 2023-12-17 01:26:46">2023-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/18/%E5%9F%BA%E4%BA%8Eipv6%E5%AE%9E%E7%8E%B0%E5%87%A0%E4%B9%8E%E9%9B%B6%E6%88%90%E6%9C%AC%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%96%B9%E6%A1%88%EF%BC%8C%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B8%A9%E5%9D%91%E5%8E%86%E7%A8%8B%E4%B8%8E%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/" title="基于ipv6实现几乎零成本的内网穿透方案，小白的踩坑历程与经验分享"><img src="/resources/img/banner1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于ipv6实现几乎零成本的内网穿透方案，小白的踩坑历程与经验分享"/></a><div class="content"><a class="title" href="/2023/06/18/%E5%9F%BA%E4%BA%8Eipv6%E5%AE%9E%E7%8E%B0%E5%87%A0%E4%B9%8E%E9%9B%B6%E6%88%90%E6%9C%AC%E7%9A%84%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%96%B9%E6%A1%88%EF%BC%8C%E5%B0%8F%E7%99%BD%E7%9A%84%E8%B8%A9%E5%9D%91%E5%8E%86%E7%A8%8B%E4%B8%8E%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/" title="基于ipv6实现几乎零成本的内网穿透方案，小白的踩坑历程与经验分享">基于ipv6实现几乎零成本的内网穿透方案，小白的踩坑历程与经验分享</a><time datetime="2023-06-18T12:51:46.000Z" title="发表于 2023-06-18 20:51:46">2023-06-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/02/%E4%BD%BF%E7%94%A8nodejs%E7%BC%96%E5%86%99%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%EF%BC%8C%E7%9C%9F%E9%A6%99%EF%BC%81/" title="使用nodejs编写自动化脚本，真香！"><img src="/resources/img/banner1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用nodejs编写自动化脚本，真香！"/></a><div class="content"><a class="title" href="/2022/07/02/%E4%BD%BF%E7%94%A8nodejs%E7%BC%96%E5%86%99%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%EF%BC%8C%E7%9C%9F%E9%A6%99%EF%BC%81/" title="使用nodejs编写自动化脚本，真香！">使用nodejs编写自动化脚本，真香！</a><time datetime="2022-07-02T10:58:46.000Z" title="发表于 2022-07-02 18:58:46">2022-07-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/02/mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90_mybatis%E7%9A%84%E7%BC%93%E5%AD%98/" title="Mybatis源码分析-Mybatis的缓存机制"><img src="/resources/img/banner1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mybatis源码分析-Mybatis的缓存机制"/></a><div class="content"><a class="title" href="/2022/05/02/mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90_mybatis%E7%9A%84%E7%BC%93%E5%AD%98/" title="Mybatis源码分析-Mybatis的缓存机制">Mybatis源码分析-Mybatis的缓存机制</a><time datetime="2022-05-02T02:58:46.000Z" title="发表于 2022-05-02 10:58:46">2022-05-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/02/spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90_spring%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%BB%84%E4%BB%B6%E7%9A%84/" title="spring源码分析_spring是如何实例化组件的"><img src="/resources/img/banner1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="spring源码分析_spring是如何实例化组件的"/></a><div class="content"><a class="title" href="/2022/05/02/spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90_spring%E6%98%AF%E5%A6%82%E4%BD%95%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%BB%84%E4%BB%B6%E7%9A%84/" title="spring源码分析_spring是如何实例化组件的">spring源码分析_spring是如何实例化组件的</a><time datetime="2022-05-02T02:58:46.000Z" title="发表于 2022-05-02 10:58:46">2022-05-02</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://cn.vitejs.dev/logo-with-shadow.png)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By 黄禄松</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '6e6b0a5e39797b6427ea',
      clientSecret: 'e6e917e87d415d71b5a4b5ce1ae94cc5293921e8',
      repo: 'commentsRepository',
      owner: 'huanglusong',
      admin: ['huanglusong'],
      id: '021d4cafab7e24ebcec25d719218a5c8',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>